# Multi-Agent Workflow Skill

A structured workflow for implementing large features while preventing context window exhaustion.

## Structure

```
multi-agent-workflow/
├── skill.md              # Main workflow instructions (loaded when skill invoked)
├── README.md            # This file
└── templates/
    ├── planner.md       # Template for planner agent prompts
    ├── coder.md         # Template for coder agent prompts
    ├── tester.md        # Template for tester agent prompts
    └── reviewer.md      # Template for reviewer agent prompts
```

## Usage

### From User Side

To invoke this workflow in a project:

```
User: "Implement the plan in plans/feature-plan.md using the multi-agent workflow"
```

Or simply:

```
User: "/multi-agent-workflow"  # If set up as a slash command
```

### From Assistant Side

When the skill is invoked, you will:

1. Read skill.md for workflow instructions
2. Launch agents using templates from templates/
3. Follow the strict process to manage context
4. Keep main thread ultra-brief (2 sentences per agent)

## Template Usage

When launching an agent, construct the prompt by:

1. Reading the appropriate template file
2. Filling in phase/step numbers and specific details
3. Including the full template content in the agent prompt

Example:
```python
# When launching planner agent:
planner_template = read("~/.claude/skills/multi-agent-workflow/templates/planner.md")
prompt = planner_template.replace("[plan-file]", "slalom-plan")

Task(
    subagent_type="Explore",
    prompt=prompt,
    description="Create detailed implementation plan"
)
```

## Key Workflow Rules

1. **Planner first, always** - No coding before planning
2. **3 file limit** - Coder agents handle max 3 files per run
3. **Commit after each agent** - No batching
4. **Logs to files** - Never in conversation
5. **Tool enforcement** - Every agent gets tool rules
6. **Main thread brevity** - 2 sentences max per agent

## Context Savings

Typical large implementation:
- **Without workflow**: 150K tokens in main thread → exhaustion at 60%
- **With workflow**: 15K tokens in main thread → completes with room to spare

## Project Integration

### For Game Template Repository

Include in `.claude/CLAUDE.md`:

```markdown
# Development Workflow

For large feature implementations or initial project setup:
- Use the multi-agent-workflow skill
- Or follow instructions in plans/multi-agent-workflow-guide.md

For normal development:
- Standard conversation, no special workflow needed
```

Include in repository:
- Copy plans/multi-agent-workflow-guide.md for reference
- Create plans/ directory for high-level plans
- Create logs/ directory for agent outputs

### Directory Structure

Projects using this workflow should have:

```
project/
├── plans/
│   ├── [feature]-plan.md        # High-level plans (user creates)
│   └── detailed-plan.md          # Generated by planner agent
├── logs/
│   ├── phase-1-tests.md          # Generated by tester agents
│   ├── phase-1-review.md         # Generated by reviewer agents
│   └── completion-summary.md     # Final summary
└── .claude/
    └── CLAUDE.md                 # References the workflow
```

## When to Use This Workflow

**Use for:**
- Initial project implementation (large scope)
- Major feature additions (>10 files)
- Complex refactoring across multiple modules
- Anything that typically causes context exhaustion

**Don't use for:**
- Small bug fixes
- Single file changes
- Quick questions or exploration
- Normal conversation development

## Customization

The templates can be customized per project:
- Copy templates to project's .claude/ directory
- Modify for project-specific needs
- Reference local templates in skill invocation

## Version

This skill was created based on lessons learned from context exhaustion issues in large implementations. See the full guide in plans/multi-agent-workflow-guide.md for background and rationale.
